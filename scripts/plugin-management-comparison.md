# Kubernetesè°ƒåº¦å™¨æ’ä»¶ç®¡ç†æ–¹å¼å¯¹æ¯”

## ğŸ“Š ç®¡ç†æ–¹å¼å¯¹æ¯”è¡¨

| ç®¡ç†æ–¹å¼ | å¤æ‚åº¦ | å®æ—¶æ€§ | ç‰ˆæœ¬æ§åˆ¶ | è‡ªåŠ¨åŒ– | å­¦ä¹ æˆæœ¬ | é€‚ç”¨åœºæ™¯ |
|---------|--------|--------|----------|--------|----------|----------|
| **ç›´æ¥ä¿®æ”¹ConfigMap** | â­ | â­â­â­ | âŒ | âŒ | â­ | ä¸´æ—¶ä¿®æ”¹ |
| **kubectl patch** | â­â­ | â­â­â­ | âŒ | â­ | â­â­ | ç®€å•è„šæœ¬ |
| **Helm** | â­â­â­ | â­â­ | â­â­â­ | â­â­ | â­â­â­ | ç”Ÿäº§ç¯å¢ƒ |
| **Kustomize** | â­â­ | â­â­ | â­â­ | â­â­ | â­â­ | å¤šç¯å¢ƒ |
| **GitOps** | â­â­â­â­ | â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | ä¼ä¸šçº§ |
| **Operator** | â­â­â­â­â­ | â­â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­â­ | å¤æ‚åœºæ™¯ |
| **Ansible** | â­â­â­ | â­â­ | â­â­ | â­â­â­ | â­â­â­ | æ··åˆç¯å¢ƒ |
| **Terraform** | â­â­â­â­ | â­â­ | â­â­â­â­ | â­â­â­â­ | â­â­â­â­ | äº‘ç¯å¢ƒ |
| **è‡ªå®šä¹‰API** | â­â­â­â­ | â­â­â­ | â­â­ | â­â­â­ | â­â­â­â­ | ä¸“ä¸šå›¢é˜Ÿ |

## ğŸ” è¯¦ç»†åˆ†æ

### 1. ç›´æ¥ä¿®æ”¹ConfigMap

#### ä¼˜ç‚¹
- âœ… ç®€å•ç›´æ¥ï¼Œæ— éœ€é¢å¤–å·¥å…·
- âœ… å®æ—¶ç”Ÿæ•ˆï¼Œä¿®æ”¹åç«‹å³åº”ç”¨
- âœ… å­¦ä¹ æˆæœ¬ä½ï¼Œå®¹æ˜“ç†è§£

#### ç¼ºç‚¹
- âŒ å®¹æ˜“å‡ºé”™ï¼Œæ²¡æœ‰éªŒè¯æœºåˆ¶
- âŒ æ— ç‰ˆæœ¬æ§åˆ¶ï¼Œéš¾ä»¥å›æ»š
- âŒ æ‰‹åŠ¨æ“ä½œï¼Œå®¹æ˜“é—æ¼æ­¥éª¤
- âŒ ä¸é€‚åˆç”Ÿäº§ç¯å¢ƒ

#### ä½¿ç”¨ç¤ºä¾‹
```bash
# è·å–å½“å‰é…ç½®
kubectl get configmap rescheduler-config -n kube-system -o yaml > config.yaml

# ç¼–è¾‘é…ç½®
vim config.yaml

# åº”ç”¨é…ç½®
kubectl apply -f config.yaml

# é‡å¯è°ƒåº¦å™¨
kubectl rollout restart deployment/rescheduler-scheduler -n kube-system
```

#### é€‚ç”¨åœºæ™¯
- ä¸´æ—¶ä¿®æ”¹å’Œæµ‹è¯•
- å¼€å‘ç¯å¢ƒå¿«é€ŸéªŒè¯
- ç´§æ€¥æƒ…å†µä¸‹çš„å¿«é€Ÿä¿®å¤

---

### 2. kubectl patch

#### ä¼˜ç‚¹
- âœ… ç›¸å¯¹ç®€å•ï¼Œä¸€æ¡å‘½ä»¤å®Œæˆ
- âœ… å®æ—¶ç”Ÿæ•ˆ
- âœ… å¯ä»¥è„šæœ¬åŒ–
- âœ… æ”¯æŒéƒ¨åˆ†æ›´æ–°

#### ç¼ºç‚¹
- âŒ å‘½ä»¤å¤æ‚ï¼Œå®¹æ˜“å‡ºé”™
- âŒ æ— ç‰ˆæœ¬æ§åˆ¶
- âŒ éš¾ä»¥ç»´æŠ¤å’Œå®¡è®¡
- âŒ ä¸æ”¯æŒå¤æ‚é…ç½®

#### ä½¿ç”¨ç¤ºä¾‹
```bash
# å¯ç”¨æ’ä»¶
kubectl patch configmap rescheduler-config -n kube-system --type merge -p '{
  "data": {
    "config.yaml": "æ–°çš„é…ç½®å†…å®¹"
  }
}'

# é‡å¯è°ƒåº¦å™¨
kubectl rollout restart deployment/rescheduler-scheduler -n kube-system
```

#### é€‚ç”¨åœºæ™¯
- ç®€å•çš„è„šæœ¬è‡ªåŠ¨åŒ–
- ä¸´æ—¶é…ç½®ä¿®æ”¹
- å¼€å‘ç¯å¢ƒå¿«é€Ÿæµ‹è¯•

---

### 3. Helm

#### ä¼˜ç‚¹
- âœ… ç‰ˆæœ¬ç®¡ç†ï¼Œæ”¯æŒå›æ»š
- âœ… æ¨¡æ¿åŒ–ï¼Œæ”¯æŒå‚æ•°åŒ–
- âœ… ä¾èµ–ç®¡ç†
- âœ… ç¤¾åŒºæ”¯æŒå¥½

#### ç¼ºç‚¹
- âŒ å­¦ä¹ æˆæœ¬è¾ƒé«˜
- âŒ é…ç½®å¤æ‚
- âŒ å®æ—¶æ€§è¾ƒå·®
- âŒ éœ€è¦é¢å¤–çš„Helmä»“åº“

#### ä½¿ç”¨ç¤ºä¾‹
```bash
# å®‰è£…
helm install scheduler-plugins ./charts/scheduler-plugins -f values.yaml

# å‡çº§
helm upgrade scheduler-plugins ./charts/scheduler-plugins -f values.yaml

# å›æ»š
helm rollback scheduler-plugins 1
```

#### é€‚ç”¨åœºæ™¯
- ç”Ÿäº§ç¯å¢ƒéƒ¨ç½²
- éœ€è¦ç‰ˆæœ¬ç®¡ç†çš„åœºæ™¯
- å¤šç¯å¢ƒé…ç½®ç®¡ç†

---

### 4. Kustomize

#### ä¼˜ç‚¹
- âœ… é…ç½®å¤ç”¨ï¼Œç¯å¢ƒç®¡ç†
- âœ… ä¸kubectlé›†æˆå¥½
- âœ… å­¦ä¹ æˆæœ¬é€‚ä¸­
- âœ… æ”¯æŒé…ç½®è¦†ç›–

#### ç¼ºç‚¹
- âŒ åŠŸèƒ½ç›¸å¯¹ç®€å•
- âŒ å®æ—¶æ€§ä¸€èˆ¬
- âŒ å¤æ‚é…ç½®æ”¯æŒæœ‰é™
- âŒ è°ƒè¯•å›°éš¾

#### ä½¿ç”¨ç¤ºä¾‹
```bash
# ç”Ÿæˆé…ç½®
kustomize build overlays/prod

# åº”ç”¨é…ç½®
kubectl apply -k overlays/prod
```

#### é€‚ç”¨åœºæ™¯
- å¤šç¯å¢ƒéƒ¨ç½²
- é…ç½®å¤ç”¨éœ€æ±‚
- ç®€å•çš„é…ç½®ç®¡ç†

---

### 5. GitOps

#### ä¼˜ç‚¹
- âœ… ç‰ˆæœ¬æ§åˆ¶å®Œå–„
- âœ… å®¡è®¡è·Ÿè¸ª
- âœ… è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜
- âœ… å›¢é˜Ÿåä½œå¥½

#### ç¼ºç‚¹
- âŒ å®æ—¶æ€§è¾ƒå·®
- âŒ éœ€è¦é¢å¤–å·¥å…·
- âŒ å­¦ä¹ æˆæœ¬é«˜
- âŒ é…ç½®å¤æ‚

#### ä½¿ç”¨ç¤ºä¾‹
```bash
# ä½¿ç”¨ArgoCD
kubectl apply -f argocd-application.yaml

# ä½¿ç”¨Flux
flux create source git scheduler-config --url=https://github.com/org/scheduler-config
flux create kustomization scheduler-config --source=scheduler-config --path=overlays/prod
```

#### é€‚ç”¨åœºæ™¯
- ä¼ä¸šçº§ç¯å¢ƒ
- éœ€è¦ä¸¥æ ¼å®¡è®¡çš„åœºæ™¯
- å›¢é˜Ÿåä½œå¼€å‘

---

### 6. Operatoræ¨¡å¼

#### ä¼˜ç‚¹
- âœ… è‡ªåŠ¨åŒ–ç¨‹åº¦é«˜
- âœ… å£°æ˜å¼ç®¡ç†
- âœ… ä¸šåŠ¡é€»è¾‘å°è£…
- âœ… æ‰©å±•æ€§å¥½

#### ç¼ºç‚¹
- âŒ å¼€å‘å¤æ‚
- âŒ å­¦ä¹ æˆæœ¬å¾ˆé«˜
- âŒ ç»´æŠ¤æˆæœ¬é«˜
- âŒ éœ€è¦Goè¯­è¨€çŸ¥è¯†

#### ä½¿ç”¨ç¤ºä¾‹
```yaml
# åˆ›å»ºè‡ªå®šä¹‰èµ„æº
apiVersion: scheduling.example.com/v1
kind: SchedulerConfig
metadata:
  name: rescheduler-config
spec:
  plugins:
    enabled:
      - name: Rescheduler
        phases: [filter, score]
  pluginConfig:
    Rescheduler:
      cpuThreshold: 80.0
```

#### é€‚ç”¨åœºæ™¯
- å¤æ‚çš„ä¸šåŠ¡é€»è¾‘
- éœ€è¦é«˜åº¦è‡ªåŠ¨åŒ–çš„åœºæ™¯
- æœ‰ä¸“ä¸šå¼€å‘å›¢é˜Ÿ

---

### 7. Ansible

#### ä¼˜ç‚¹
- âœ… é…ç½®ç®¡ç†å¼ºå¤§
- âœ… å¹‚ç­‰æ€§ä¿è¯
- âœ… æ”¯æŒå¤šå¹³å°
- âœ… ç¤¾åŒºæ”¯æŒå¥½

#### ç¼ºç‚¹
- âŒ å­¦ä¹ æˆæœ¬è¾ƒé«˜
- âŒ å®æ—¶æ€§ä¸€èˆ¬
- âŒ éœ€è¦AnsibleçŸ¥è¯†
- âŒ è°ƒè¯•å¤æ‚

#### ä½¿ç”¨ç¤ºä¾‹
```yaml
# playbook
- name: Manage Scheduler Plugins
  hosts: k8s-masters
  tasks:
    - name: Update scheduler config
      kubernetes.core.k8s:
        state: present
        definition: "{{ scheduler_config }}"
```

#### é€‚ç”¨åœºæ™¯
- æ··åˆç¯å¢ƒç®¡ç†
- éœ€è¦é…ç½®ç®¡ç†çš„åœºæ™¯
- æœ‰Ansibleç»éªŒçš„å›¢é˜Ÿ

---

### 8. Terraform

#### ä¼˜ç‚¹
- âœ… åŸºç¡€è®¾æ–½å³ä»£ç 
- âœ… çŠ¶æ€ç®¡ç†
- âœ… ç‰ˆæœ¬æ§åˆ¶
- âœ… äº‘ç¯å¢ƒæ”¯æŒå¥½

#### ç¼ºç‚¹
- âŒ å­¦ä¹ æˆæœ¬é«˜
- âŒ çŠ¶æ€ç®¡ç†å¤æ‚
- âŒ å®æ—¶æ€§ä¸€èˆ¬
- âŒ éœ€è¦TerraformçŸ¥è¯†

#### ä½¿ç”¨ç¤ºä¾‹
```hcl
resource "kubernetes_config_map" "scheduler_config" {
  metadata {
    name      = "rescheduler-config"
    namespace = "kube-system"
  }
  data = {
    "config.yaml" = templatefile("${path.module}/scheduler-config.yaml.tpl", {
      cpu_threshold = var.cpu_threshold
    })
  }
}
```

#### é€‚ç”¨åœºæ™¯
- äº‘ç¯å¢ƒéƒ¨ç½²
- åŸºç¡€è®¾æ–½ç®¡ç†
- æœ‰Terraformç»éªŒçš„å›¢é˜Ÿ

---

### 9. è‡ªå®šä¹‰APIç³»ç»Ÿ

#### ä¼˜ç‚¹
- âœ… å®æ—¶æ€§æœ€å¥½
- âœ… åŠŸèƒ½å®šåˆ¶åŒ–
- âœ… ç”¨æˆ·ä½“éªŒå¥½
- âœ… é›†æˆåº¦é«˜

#### ç¼ºç‚¹
- âŒ å¼€å‘æˆæœ¬é«˜
- âŒ ç»´æŠ¤æˆæœ¬é«˜
- âŒ éœ€è¦ä¸“ä¸šå›¢é˜Ÿ
- âŒ å­¦ä¹ æˆæœ¬é«˜

#### ä½¿ç”¨ç¤ºä¾‹
```bash
# ä½¿ç”¨API
curl -X POST http://localhost:8080/api/v1/plugins/Rescheduler/enable \
  -H "Content-Type: application/json" \
  -d '{"phases": ["filter", "score"]}'
```

#### é€‚ç”¨åœºæ™¯
- ä¸“ä¸šè¿ç»´å›¢é˜Ÿ
- éœ€è¦é«˜åº¦å®šåˆ¶åŒ–çš„åœºæ™¯
- å¯¹å®æ—¶æ€§è¦æ±‚å¾ˆé«˜

## ğŸ¯ é€‰æ‹©å»ºè®®

### æ ¹æ®å›¢é˜Ÿè§„æ¨¡é€‰æ‹©

#### å°å›¢é˜Ÿ (1-5äºº)
- **æ¨è**: ç›´æ¥ä¿®æ”¹ConfigMap + kubectl patch
- **ç†ç”±**: ç®€å•ç›´æ¥ï¼Œå­¦ä¹ æˆæœ¬ä½
- **å·¥å…·**: `simple-plugin-manager.sh`

#### ä¸­ç­‰å›¢é˜Ÿ (5-20äºº)
- **æ¨è**: Helm + Kustomize
- **ç†ç”±**: å¹³è¡¡äº†åŠŸèƒ½å’Œå¤æ‚åº¦
- **å·¥å…·**: Helm charts + Kustomize overlays

#### å¤§å›¢é˜Ÿ (20+äºº)
- **æ¨è**: GitOps + Operator
- **ç†ç”±**: ä¼ä¸šçº§åŠŸèƒ½ï¼Œå›¢é˜Ÿåä½œå¥½
- **å·¥å…·**: ArgoCD/Flux + è‡ªå®šä¹‰Operator

### æ ¹æ®ç¯å¢ƒå¤æ‚åº¦é€‰æ‹©

#### ç®€å•ç¯å¢ƒ
- **æ¨è**: ç›´æ¥ä¿®æ”¹ + è„šæœ¬è‡ªåŠ¨åŒ–
- **ç‰¹ç‚¹**: å•é›†ç¾¤ï¼Œé…ç½®ç®€å•

#### ä¸­ç­‰ç¯å¢ƒ
- **æ¨è**: Helm + Kustomize
- **ç‰¹ç‚¹**: å¤šç¯å¢ƒï¼Œé…ç½®å¤ç”¨

#### å¤æ‚ç¯å¢ƒ
- **æ¨è**: GitOps + Operator + è‡ªå®šä¹‰API
- **ç‰¹ç‚¹**: å¤šé›†ç¾¤ï¼Œå¤æ‚ä¸šåŠ¡é€»è¾‘

### æ ¹æ®å®æ—¶æ€§è¦æ±‚é€‰æ‹©

#### é«˜å®æ—¶æ€§è¦æ±‚
- **æ¨è**: è‡ªå®šä¹‰APIç³»ç»Ÿ
- **ç‰¹ç‚¹**: æ¯«ç§’çº§å“åº”ï¼Œå®æ—¶ç”Ÿæ•ˆ

#### ä¸­ç­‰å®æ—¶æ€§è¦æ±‚
- **æ¨è**: kubectl patch + è„šæœ¬
- **ç‰¹ç‚¹**: ç§’çº§å“åº”ï¼Œç®€å•å®ç°

#### ä½å®æ—¶æ€§è¦æ±‚
- **æ¨è**: GitOps + Helm
- **ç‰¹ç‚¹**: åˆ†é’Ÿçº§å“åº”ï¼Œç‰ˆæœ¬ç®¡ç†

## ğŸ“‹ å®æ–½å»ºè®®

### é˜¶æ®µ1: åŸºç¡€ç®¡ç† (1-2å‘¨)
1. ä½¿ç”¨ç›´æ¥ä¿®æ”¹ConfigMapæ–¹å¼
2. åˆ›å»ºç®€å•çš„ç®¡ç†è„šæœ¬
3. å»ºç«‹åŸºæœ¬çš„å¤‡ä»½æœºåˆ¶

### é˜¶æ®µ2: è„šæœ¬è‡ªåŠ¨åŒ– (2-4å‘¨)
1. ä½¿ç”¨kubectl patchæ–¹å¼
2. åˆ›å»ºè‡ªåŠ¨åŒ–è„šæœ¬
3. æ·»åŠ é”™è¯¯å¤„ç†å’Œæ—¥å¿—

### é˜¶æ®µ3: ç‰ˆæœ¬ç®¡ç† (1-2ä¸ªæœˆ)
1. å¼•å…¥Helmæˆ–Kustomize
2. å»ºç«‹ç‰ˆæœ¬æ§åˆ¶æµç¨‹
3. åˆ›å»ºå¤šç¯å¢ƒé…ç½®

### é˜¶æ®µ4: ä¼ä¸šçº§ç®¡ç† (2-6ä¸ªæœˆ)
1. å¼•å…¥GitOpsæµç¨‹
2. å¼€å‘è‡ªå®šä¹‰Operator
3. å»ºç«‹å®Œæ•´çš„ç›‘æ§å’Œå‘Šè­¦

## ğŸ”§ å·¥å…·æ¨è

### å¼€å‘ç¯å¢ƒ
- **å·¥å…·**: `simple-plugin-manager.sh`
- **ç‰¹ç‚¹**: ç®€å•ç›´æ¥ï¼Œå¿«é€ŸéªŒè¯

### æµ‹è¯•ç¯å¢ƒ
- **å·¥å…·**: Helm + Kustomize
- **ç‰¹ç‚¹**: ç‰ˆæœ¬ç®¡ç†ï¼Œç¯å¢ƒéš”ç¦»

### ç”Ÿäº§ç¯å¢ƒ
- **å·¥å…·**: GitOps + è‡ªå®šä¹‰API
- **ç‰¹ç‚¹**: ä¼ä¸šçº§åŠŸèƒ½ï¼Œé«˜å¯ç”¨

## ğŸ“š å­¦ä¹ èµ„æº

### åŸºç¡€å­¦ä¹ 
- Kuberneteså®˜æ–¹æ–‡æ¡£
- kubectlå‘½ä»¤å‚è€ƒ
- ConfigMapå’ŒDeploymentç®¡ç†

### è¿›é˜¶å­¦ä¹ 
- Helmå®˜æ–¹æ–‡æ¡£
- Kustomizeå®˜æ–¹æ–‡æ¡£
- GitOpsæœ€ä½³å®è·µ

### é«˜çº§å­¦ä¹ 
- Operator SDK
- Kubernetes APIå¼€å‘
- å¾®æœåŠ¡æ¶æ„è®¾è®¡

## ğŸ‰ æ€»ç»“

é€‰æ‹©åˆé€‚çš„ç®¡ç†æ–¹å¼éœ€è¦è€ƒè™‘ï¼š

1. **å›¢é˜ŸæŠ€èƒ½æ°´å¹³**: é€‰æ‹©å›¢é˜Ÿèƒ½å¤ŸæŒæ¡çš„å·¥å…·
2. **ç¯å¢ƒå¤æ‚åº¦**: æ ¹æ®ç¯å¢ƒéœ€æ±‚é€‰æ‹©åŠŸèƒ½
3. **å®æ—¶æ€§è¦æ±‚**: æ ¹æ®ä¸šåŠ¡éœ€æ±‚é€‰æ‹©å“åº”é€Ÿåº¦
4. **ç»´æŠ¤æˆæœ¬**: è€ƒè™‘é•¿æœŸç»´æŠ¤çš„æŠ•å…¥
5. **æ‰©å±•æ€§éœ€æ±‚**: è€ƒè™‘æœªæ¥å‘å±•çš„éœ€è¦

æ²¡æœ‰ä¸€ç§æ–¹å¼æ˜¯å®Œç¾çš„ï¼Œå…³é”®æ˜¯æ ¹æ®å®é™…æƒ…å†µé€‰æ‹©æœ€é€‚åˆçš„ç»„åˆã€‚å»ºè®®ä»ç®€å•çš„æ–¹å¼å¼€å§‹ï¼Œéšç€éœ€æ±‚å¢é•¿é€æ­¥å‡çº§åˆ°æ›´å¤æ‚çš„ç®¡ç†æ–¹å¼ã€‚
