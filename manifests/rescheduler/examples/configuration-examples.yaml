# ğŸ”§ é‡è°ƒåº¦å™¨é…ç½®ç¤ºä¾‹é›†åˆ - æ›´æ–°ç‰ˆæœ¬
# åŒ¹é…é‡æ„åçš„ä»£ç å‚æ•°

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹1ï¼šç”Ÿäº§ç¯å¢ƒä¿å®ˆé…ç½®
# é€‚ç”¨äºï¼šç”Ÿäº§ç¯å¢ƒã€ç¨³å®šæ€§ä¼˜å…ˆçš„åœºæ™¯
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-production
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    env: production
    config-type: conservative
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    leaderElection:
      leaderElect: true
      leaseDuration: 30s        # å¢åŠ ç§Ÿçº¦æ—¶é—´æé«˜ç¨³å®šæ€§
      renewDeadline: 20s
      retryPeriod: 5s
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          # ç”Ÿäº§ç¯å¢ƒå¯ä»¥å…³é—­PreBindä»¥å‡å°‘å¤æ‚æ€§
          # preBind:
          #   enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            # ä¿å®ˆçš„é‡è°ƒåº¦é…ç½®
            reschedulingInterval: "120s"            # 2åˆ†é’Ÿæ£€æŸ¥é—´éš”
            cpuThreshold: 95.0                      # é«˜é˜ˆå€¼å‡å°‘è¯¯è§¦å‘
            memoryThreshold: 95.0
            
            # æ’é™¤å…³é”®å‘½åç©ºé—´
            excludedNamespaces:
              - "kube-system"
              - "kube-public"
              - "kube-node-lease"
              - "istio-system"      # æœåŠ¡ç½‘æ ¼
              - "monitoring"        # ç›‘æ§ç³»ç»Ÿ
              - "logging"           # æ—¥å¿—ç³»ç»Ÿ
              - "backup"            # å¤‡ä»½ç³»ç»Ÿ
            
            # ä¿å®ˆçš„è°ƒåº¦ä¼˜åŒ–
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: false     # å…³é—­é¢„é˜²æ€§é‡è°ƒåº¦
            cpuScoreWeight: 0.8                     # æ›´é‡è§†CPU
            memoryScoreWeight: 0.2
            loadBalanceBonus: 3.0                   # å°å¹…å¥–åŠ±

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹2ï¼šå¼€å‘/æµ‹è¯•ç¯å¢ƒæ¿€è¿›é…ç½®
# é€‚ç”¨äºï¼šå¼€å‘æµ‹è¯•ã€å¿«é€Ÿå“åº”çš„åœºæ™¯
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-development
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    env: development
    config-type: aggressive
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    leaderElection:
      leaderElect: false      # å¼€å‘ç¯å¢ƒå…³é—­é¢†å¯¼è€…é€‰ä¸¾
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          reserve:
            enabled: [name: Rescheduler]
          preBind:
            enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            # æ¿€è¿›çš„é‡è°ƒåº¦é…ç½®
            reschedulingInterval: "15s"             # é«˜é¢‘æ£€æŸ¥
            cpuThreshold: 50.0                      # ä½é˜ˆå€¼
            memoryThreshold: 50.0
            
            excludedNamespaces:
              - "kube-system"
            
            # å…¨åŠŸèƒ½è°ƒåº¦ä¼˜åŒ–
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: true
            cpuScoreWeight: 0.6
            memoryScoreWeight: 0.4
            loadBalanceBonus: 20.0                  # é«˜å¥–åŠ±ä¿ƒè¿›è´Ÿè½½å‡è¡¡

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹3ï¼šCPUå¯†é›†å‹å·¥ä½œè´Ÿè½½é…ç½®
# é€‚ç”¨äºï¼šè®¡ç®—å¯†é›†å‹åº”ç”¨ã€CPUèµ„æºç´§å¼ çš„åœºæ™¯
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-cpu-intensive
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    workload-type: cpu-intensive
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          reserve:
            enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            reschedulingInterval: "60s"
            cpuThreshold: 85.0                      # CPUé‡è¦ï¼Œé˜ˆå€¼ç¨ä½
            memoryThreshold: 90.0                   # å†…å­˜æ¬¡è¦ï¼Œé˜ˆå€¼è¾ƒé«˜
            
            excludedNamespaces:
              - "kube-system"
              - "gpu-operator"        # æ’é™¤GPUæ“ä½œç³»ç»Ÿ
            
            # CPUä¼˜å…ˆçš„æƒé‡é…ç½®
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: true
            cpuScoreWeight: 0.8                     # é«˜CPUæƒé‡
            memoryScoreWeight: 0.2                  # ä½å†…å­˜æƒé‡
            loadBalanceBonus: 12.0

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹4ï¼šå†…å­˜å¯†é›†å‹å·¥ä½œè´Ÿè½½é…ç½®
# é€‚ç”¨äºï¼šå†…å­˜å¯†é›†å‹åº”ç”¨ã€å¤§æ•°æ®å¤„ç†åœºæ™¯
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-memory-intensive
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    workload-type: memory-intensive
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          preBind:
            enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            reschedulingInterval: "45s"
            cpuThreshold: 90.0                      # CPUæ¬¡è¦ï¼Œé˜ˆå€¼è¾ƒé«˜
            memoryThreshold: 75.0                   # å†…å­˜é‡è¦ï¼Œé˜ˆå€¼è¾ƒä½
            
            excludedNamespaces:
              - "kube-system"
              - "database"            # ä¿æŠ¤æ•°æ®åº“Pod
              - "cache"               # ä¿æŠ¤ç¼“å­˜Pod
            
            # å†…å­˜ä¼˜å…ˆçš„æƒé‡é…ç½®
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: true
            cpuScoreWeight: 0.3                     # ä½CPUæƒé‡
            memoryScoreWeight: 0.7                  # é«˜å†…å­˜æƒé‡
            loadBalanceBonus: 8.0

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹5ï¼šå¾®æœåŠ¡æ¶æ„é…ç½®
# é€‚ç”¨äºï¼šå¤§é‡å°æœåŠ¡ã€å®¹å™¨å¯†åº¦é«˜çš„åœºæ™¯
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-microservices
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    architecture: microservices
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          reserve:
            enabled: [name: Rescheduler]
          preBind:
            enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            reschedulingInterval: "30s"             # ä¸­ç­‰é¢‘ç‡
            cpuThreshold: 80.0                      # æ ‡å‡†é˜ˆå€¼
            memoryThreshold: 80.0
            
            excludedNamespaces:
              - "kube-system"
              - "istio-system"        # æœåŠ¡ç½‘æ ¼
              - "ingress-nginx"       # å…¥å£æ§åˆ¶å™¨
            
            # å‡è¡¡çš„æƒé‡é…ç½®
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: true
            cpuScoreWeight: 0.6                     # å‡è¡¡æƒé‡
            memoryScoreWeight: 0.4
            loadBalanceBonus: 15.0                  # é«˜å¥–åŠ±ä¿ƒè¿›åˆ†æ•£

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹6ï¼šä»…è°ƒåº¦ä¼˜åŒ–é…ç½®ï¼ˆå…³é—­é‡è°ƒåº¦æ§åˆ¶å™¨ï¼‰
# é€‚ç”¨äºï¼šåªæƒ³è¦è°ƒåº¦ä¼˜åŒ–ï¼Œä¸éœ€è¦ä¸»åŠ¨é‡è°ƒåº¦çš„åœºæ™¯
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-schedule-only
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    mode: schedule-only
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          # å¯é€‰ï¼šå¯ç”¨é¢„ç•™æœºåˆ¶
          reserve:
            enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            cpuThreshold: 85.0
            memoryThreshold: 85.0
            
            excludedNamespaces:
              - "kube-system"
            
            # ä»…å¯ç”¨è°ƒåº¦ä¼˜åŒ–
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: false
            enableReschedulingController: false     # å…³é—­é‡è°ƒåº¦æ§åˆ¶å™¨
            cpuScoreWeight: 0.6
            memoryScoreWeight: 0.4
            loadBalanceBonus: 10.0

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹7ï¼šè°ƒè¯•é…ç½®
# é€‚ç”¨äºï¼šé—®é¢˜æ’æŸ¥ã€è¯¦ç»†æ—¥å¿—çš„åœºæ™¯
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-debug
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    mode: debug
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    # è°ƒè¯•æ¨¡å¼å®¢æˆ·ç«¯é…ç½®
    clientConnection:
      qps: 20               # é™ä½QPSä¾¿äºè§‚å¯Ÿ
      burst: 40
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          reserve:
            enabled: [name: Rescheduler]
          preBind:
            enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            # è°ƒè¯•å‹å¥½çš„é…ç½®
            reschedulingInterval: "60s"             # è¾ƒæ…¢çš„æ£€æŸ¥é—´éš”ä¾¿äºè§‚å¯Ÿ
            cpuThreshold: 70.0                      # è¾ƒä½é˜ˆå€¼ä¾¿äºè§¦å‘
            memoryThreshold: 70.0
            
            excludedNamespaces:
              - "kube-system"
            
            # å…¨åŠŸèƒ½å¯ç”¨ä¾¿äºæµ‹è¯•
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: true
            enableReschedulingController: true
            cpuScoreWeight: 0.6
            memoryScoreWeight: 0.4
            loadBalanceBonus: 10.0
