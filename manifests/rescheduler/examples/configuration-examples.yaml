# ğŸ”§ é‡è°ƒåº¦å™¨é…ç½®ç¤ºä¾‹é›†åˆ
# åŒ…å«å„ç§ä½¿ç”¨åœºæ™¯çš„é…ç½®ç¤ºä¾‹

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹1ï¼šç”Ÿäº§ç¯å¢ƒä¿å®ˆé…ç½®
# é€‚ç”¨äºï¼šç”Ÿäº§ç¯å¢ƒã€ç¨³å®šæ€§ä¼˜å…ˆçš„åœºæ™¯
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-production
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    env: production
    config-type: conservative
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    leaderElection:
      leaderElect: true
      leaseDuration: 30s        # å¢åŠ ç§Ÿçº¦æ—¶é—´æé«˜ç¨³å®šæ€§
      renewDeadline: 20s
      retryPeriod: 5s
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          # ç”Ÿäº§ç¯å¢ƒå¯ä»¥å…³é—­PreBindä»¥å‡å°‘å¤æ‚æ€§
          # preBind:
          #   enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            # ä¿å®ˆçš„é‡è°ƒåº¦é…ç½®
            reschedulingInterval: "120s"            # 2åˆ†é’Ÿæ£€æŸ¥é—´éš”
            enabledStrategies: ["LoadBalancing"]    # ä»…å¯ç”¨è´Ÿè½½å‡è¡¡
            cpuThreshold: 95.0                      # é«˜é˜ˆå€¼å‡å°‘è¯¯è§¦å‘
            memoryThreshold: 95.0
            imbalanceThreshold: 40.0                # é«˜ä¸å¹³è¡¡é˜ˆå€¼
            maxReschedulePods: 3                    # é™åˆ¶é‡è°ƒåº¦æ•°é‡
            
            # æ’é™¤å…³é”®å‘½åç©ºé—´
            excludedNamespaces:
              - "kube-system"
              - "kube-public"
              - "kube-node-lease" 
              - "istio-system"
              - "monitoring"
              - "logging"
              - "database"        # æ’é™¤æ•°æ®åº“å‘½åç©ºé—´
            
            # è°ƒåº¦ä¼˜åŒ–ï¼šå¯ç”¨ä½†ä¿å®ˆ
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: false     # å…³é—­é¢„é˜²æ€§é‡è°ƒåº¦
            cpuScoreWeight: 0.8                     # æ›´é‡è§†CPU
            memoryScoreWeight: 0.2
            loadBalanceBonus: 3.0                   # å°çš„å¥–åŠ±åˆ†æ•°

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹2ï¼šå¼€å‘æµ‹è¯•ç¯å¢ƒæ¿€è¿›é…ç½®  
# é€‚ç”¨äºï¼šå¼€å‘ç¯å¢ƒã€æµ‹è¯•ç¯å¢ƒã€åŠŸèƒ½éªŒè¯
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-development
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    env: development
    config-type: aggressive
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    leaderElection:
      leaderElect: false          # å¼€å‘ç¯å¢ƒå¯ä»¥å…³é—­
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          preBind:
            enabled: [name: Rescheduler]    # å¯ç”¨æ‰€æœ‰åŠŸèƒ½
        
        pluginConfig:
        - name: Rescheduler
          args:
            # æ¿€è¿›çš„é‡è°ƒåº¦é…ç½®
            reschedulingInterval: "15s"             # é«˜é¢‘æ£€æŸ¥
            enabledStrategies:
              - "LoadBalancing"
              - "ResourceOptimization"
              - "NodeMaintenance"
            cpuThreshold: 50.0                      # ä½é˜ˆå€¼
            memoryThreshold: 50.0
            imbalanceThreshold: 10.0                # ä½ä¸å¹³è¡¡é˜ˆå€¼
            maxReschedulePods: 50                   # é«˜é‡è°ƒåº¦é™åˆ¶
            
            excludedNamespaces:
              - "kube-system"
            
            # å…¨åŠŸèƒ½è°ƒåº¦ä¼˜åŒ–
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: true      # å¯ç”¨é¢„é˜²æ€§é‡è°ƒåº¦
            cpuScoreWeight: 0.5
            memoryScoreWeight: 0.5
            loadBalanceBonus: 20.0                  # é«˜å¥–åŠ±åˆ†æ•°

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹3ï¼šé«˜æ€§èƒ½è®¡ç®—(HPC)ç¯å¢ƒé…ç½®
# é€‚ç”¨äºï¼šCPUå¯†é›†å‹å·¥ä½œè´Ÿè½½ã€ç§‘å­¦è®¡ç®—ã€AI/MLè®­ç»ƒ
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-hpc
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    env: hpc
    config-type: cpu-optimized
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          preBind:
            enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            reschedulingInterval: "60s"
            enabledStrategies:
              - "LoadBalancing"
              - "ResourceOptimization"
            cpuThreshold: 85.0                      # CPUé‡è¦ï¼Œé˜ˆå€¼ç¨ä½
            memoryThreshold: 90.0                   # å†…å­˜æ¬¡è¦ï¼Œé˜ˆå€¼è¾ƒé«˜
            imbalanceThreshold: 15.0
            maxReschedulePods: 8
            
            excludedNamespaces:
              - "kube-system"
              - "gpu-operator"        # æ’é™¤GPUæ“ä½œç³»ç»Ÿ
            
            # CPUä¼˜åŒ–é…ç½®
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: true
            cpuScoreWeight: 0.8                     # é‡è§†CPU
            memoryScoreWeight: 0.2                  # è½»è§†å†…å­˜
            loadBalanceBonus: 15.0

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹4ï¼šå†…å­˜å¯†é›†å‹åº”ç”¨é…ç½®
# é€‚ç”¨äºï¼šæ•°æ®åº“ã€ç¼“å­˜ç³»ç»Ÿã€å¤§æ•°æ®å¤„ç†
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-memory-intensive
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    env: memory-intensive
    config-type: memory-optimized
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          preBind:
            enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            reschedulingInterval: "45s"
            enabledStrategies:
              - "LoadBalancing"
              - "ResourceOptimization"
            cpuThreshold: 90.0                      # CPUæ¬¡è¦
            memoryThreshold: 75.0                   # å†…å­˜é‡è¦ï¼Œé˜ˆå€¼è¾ƒä½
            imbalanceThreshold: 20.0
            maxReschedulePods: 6
            
            excludedNamespaces:
              - "kube-system"
              - "database"
              - "redis"
              - "elasticsearch"
            
            # å†…å­˜ä¼˜åŒ–é…ç½®
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: true
            cpuScoreWeight: 0.3                     # è½»è§†CPU
            memoryScoreWeight: 0.7                  # é‡è§†å†…å­˜
            loadBalanceBonus: 12.0

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹5ï¼šå¾®æœåŠ¡æ¶æ„é…ç½®
# é€‚ç”¨äºï¼šå¾®æœåŠ¡ã€äº‘åŸç”Ÿåº”ç”¨ã€å®¹å™¨åŒ–åº”ç”¨
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-microservices
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    env: microservices
    config-type: balanced
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          preBind:
            enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            reschedulingInterval: "30s"             # æ ‡å‡†é—´éš”
            enabledStrategies:
              - "LoadBalancing"
              - "ResourceOptimization"
              - "NodeMaintenance"
            cpuThreshold: 80.0                      # å¹³è¡¡çš„é˜ˆå€¼
            memoryThreshold: 80.0
            imbalanceThreshold: 25.0
            maxReschedulePods: 15                   # å¾®æœåŠ¡æ•°é‡å¤šï¼Œå…è®¸æ›´å¤šé‡è°ƒåº¦
            
            excludedNamespaces:
              - "kube-system"
              - "istio-system"
              - "linkerd"
              - "monitoring"
            
            # å¹³è¡¡çš„è°ƒåº¦ä¼˜åŒ–
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: true
            cpuScoreWeight: 0.6                     # å¹³è¡¡æƒé‡
            memoryScoreWeight: 0.4
            loadBalanceBonus: 10.0

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹6ï¼šä»…è°ƒåº¦ä¼˜åŒ–é…ç½®ï¼ˆå…³é—­é‡è°ƒåº¦ï¼‰
# é€‚ç”¨äºï¼šåªæƒ³è¦æ™ºèƒ½è°ƒåº¦ï¼Œä¸è¦é‡è°ƒåº¦çš„åœºæ™¯
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-scheduling-only
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    env: scheduling-only
    config-type: no-rescheduling
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          # ä¸å¯ç”¨PreBindï¼Œå…³é—­é‡è°ƒåº¦åŠŸèƒ½
        
        pluginConfig:
        - name: Rescheduler
          args:
            # å…³é—­é‡è°ƒåº¦åŠŸèƒ½
            reschedulingInterval: "0s"              # è®¾ç½®ä¸º0å…³é—­é‡è°ƒåº¦
            enabledStrategies: []                   # ç©ºç­–ç•¥åˆ—è¡¨
            
            # ä»…è°ƒåº¦ä¼˜åŒ–é…ç½®
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: false     # å…³é—­é¢„é˜²æ€§é‡è°ƒåº¦
            cpuScoreWeight: 0.6
            memoryScoreWeight: 0.4
            loadBalanceBonus: 15.0

---
# ============================================================================
# ğŸ“‹ ç¤ºä¾‹7ï¼šå¤šç§Ÿæˆ·ç¯å¢ƒé…ç½®
# é€‚ç”¨äºï¼šå¤šç§Ÿæˆ·é›†ç¾¤ã€SaaSå¹³å°ã€å…±äº«é›†ç¾¤
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: rescheduler-config-multitenant
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    env: multitenant
    config-type: tenant-aware
data:
  config.yaml: |
    apiVersion: kubescheduler.config.k8s.io/v1
    kind: KubeSchedulerConfiguration
    
    profiles:
      - schedulerName: rescheduler-scheduler
        plugins:
          filter:
            enabled: [name: Rescheduler]
          score:
            enabled: [name: Rescheduler]
          preBind:
            enabled: [name: Rescheduler]
        
        pluginConfig:
        - name: Rescheduler
          args:
            reschedulingInterval: "90s"             # è¾ƒé•¿é—´éš”å‡å°‘å½±å“
            enabledStrategies:
              - "LoadBalancing"
            cpuThreshold: 85.0
            memoryThreshold: 85.0
            imbalanceThreshold: 30.0
            maxReschedulePods: 5                    # é™åˆ¶å½±å“èŒƒå›´
            
            # æ’é™¤ç§Ÿæˆ·ç³»ç»Ÿå‘½åç©ºé—´
            excludedNamespaces:
              - "kube-system"
              - "tenant-system"
              - "platform-services"
              - "monitoring"
              - "logging"
              - "ingress-nginx"
            
            # æ’é™¤ç‰¹å®šæ ‡ç­¾çš„Podï¼ˆç§Ÿæˆ·å…³é”®æœåŠ¡ï¼‰
            excludedPodSelector: "tier=critical,tenant.io/protected=true"
            
            enableSchedulingOptimization: true
            enablePreventiveRescheduling: false     # å¤šç§Ÿæˆ·ç¯å¢ƒä¿å®ˆ
            cpuScoreWeight: 0.6
            memoryScoreWeight: 0.4
            loadBalanceBonus: 8.0

---
# ============================================================================
# ğŸ“‹ ä½¿ç”¨è¯´æ˜ ConfigMap
# ============================================================================
apiVersion: v1
kind: ConfigMap
metadata:
  name: configuration-examples-guide
  namespace: kube-system
  labels:
    app: rescheduler-scheduler
    component: documentation
data:
  README.md: |
    # é‡è°ƒåº¦å™¨é…ç½®ç¤ºä¾‹ä½¿ç”¨æŒ‡å—
    
    ## ğŸ“‹ é…ç½®é€‰æ‹©æŒ‡å—
    
    | ç¯å¢ƒç±»å‹ | æ¨èé…ç½® | è¯´æ˜ |
    |---------|---------|------|
    | ç”Ÿäº§ç¯å¢ƒ | rescheduler-config-production | ä¿å®ˆé…ç½®ï¼Œç¨³å®šæ€§ä¼˜å…ˆ |
    | å¼€å‘æµ‹è¯• | rescheduler-config-development | æ¿€è¿›é…ç½®ï¼ŒåŠŸèƒ½å®Œæ•´ |
    | HPCè®¡ç®— | rescheduler-config-hpc | CPUä¼˜åŒ–é…ç½® |
    | æ•°æ®åº“/ç¼“å­˜ | rescheduler-config-memory-intensive | å†…å­˜ä¼˜åŒ–é…ç½® |
    | å¾®æœåŠ¡ | rescheduler-config-microservices | å¹³è¡¡é…ç½® |
    | ä»…è°ƒåº¦ | rescheduler-config-scheduling-only | å…³é—­é‡è°ƒåº¦åŠŸèƒ½ |
    | å¤šç§Ÿæˆ· | rescheduler-config-multitenant | ç§Ÿæˆ·æ„ŸçŸ¥é…ç½® |
    
    ## ğŸ”§ åº”ç”¨é…ç½®
    
    ### æ–¹æ³•1ï¼šç›´æ¥æ›¿æ¢é…ç½®
    ```bash
    # é€‰æ‹©é€‚åˆçš„é…ç½®å¹¶é‡å‘½å
    kubectl get configmap rescheduler-config-production -o yaml | \
      sed 's/rescheduler-config-production/rescheduler-config/' | \
      kubectl apply -f -
    
    # é‡å¯è°ƒåº¦å™¨åº”ç”¨æ–°é…ç½®
    kubectl rollout restart deployment -n kube-system rescheduler-scheduler
    ```
    
    ### æ–¹æ³•2ï¼šä½¿ç”¨kustomize
    ```bash
    # åœ¨ kustomization.yaml ä¸­æŒ‡å®šé…ç½®
    patchesStrategicMerge:
      - config-production.yaml
    ```
    
    ## âš™ï¸ é…ç½®å‚æ•°è¯´æ˜
    
    ### é‡è°ƒåº¦é—´éš”å»ºè®®
    - **ç”Ÿäº§ç¯å¢ƒ**: 60-120ç§’ï¼ˆç¨³å®šæ€§ä¼˜å…ˆï¼‰
    - **å¼€å‘ç¯å¢ƒ**: 15-30ç§’ï¼ˆå¿«é€Ÿåé¦ˆï¼‰
    - **é«˜è´Ÿè½½ç¯å¢ƒ**: 90-180ç§’ï¼ˆå‡å°‘å¹²æ‰°ï¼‰
    
    ### é˜ˆå€¼è®¾ç½®å»ºè®®
    - **ä¿å®ˆ**: CPU/å†…å­˜ 90-95%
    - **å¹³è¡¡**: CPU/å†…å­˜ 80-85%
    - **æ¿€è¿›**: CPU/å†…å­˜ 60-70%
    
    ### é‡è°ƒåº¦æ•°é‡é™åˆ¶
    - **ç”Ÿäº§ç¯å¢ƒ**: 3-5ä¸ªï¼ˆå‡å°‘å½±å“ï¼‰
    - **å¼€å‘ç¯å¢ƒ**: 10-50ä¸ªï¼ˆå¿«é€Ÿä¼˜åŒ–ï¼‰
    - **å¾®æœåŠ¡**: 10-20ä¸ªï¼ˆé€‚åº”Podæ•°é‡ï¼‰
    
    ## ğŸ¯ æœ€ä½³å®è·µ
    
    1. **ä»ä¿å®ˆé…ç½®å¼€å§‹**ï¼šå…ˆä½¿ç”¨ç”Ÿäº§ç¯å¢ƒé…ç½®éªŒè¯ç¨³å®šæ€§
    2. **é€æ­¥è°ƒä¼˜**ï¼šæ ¹æ®å®é™…æƒ…å†µè°ƒæ•´é˜ˆå€¼å’Œé—´éš”
    3. **ç›‘æ§å½±å“**ï¼šè§‚å¯Ÿé‡è°ƒåº¦å¯¹åº”ç”¨çš„å½±å“
    4. **ç¯å¢ƒéš”ç¦»**ï¼šä¸åŒç¯å¢ƒä½¿ç”¨ä¸åŒé…ç½®
    5. **æ’é™¤å…³é”®æœåŠ¡**ï¼šå°†å…³é”®æœåŠ¡æ’é™¤åœ¨é‡è°ƒåº¦ä¹‹å¤–
    
    ## ğŸš¨ æ³¨æ„äº‹é¡¹
    
    - ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯è°ƒåº¦å™¨Pod
    - é‡è°ƒåº¦å¯èƒ½å½±å“æœ‰çŠ¶æ€åº”ç”¨
    - å»ºè®®åœ¨ç»´æŠ¤çª—å£æœŸé—´è°ƒæ•´é…ç½®
    - ç›‘æ§é‡è°ƒåº¦é¢‘ç‡é¿å…è¿‡åº¦ä¼˜åŒ–
